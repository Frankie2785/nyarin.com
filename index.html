<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyarin Counter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Shadows+Into+Light&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f3a6ef;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            font-family: "Comic Neue", serif;
            font-weight: 700;
        }
        .container {
            text-align: center;
        }
        .global-number {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            color: #2b2b2b;
            font-family: "Comic Neue", serif;
            font-weight: 700;
        }
        .global-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #000;
            font-family: "Comic Neue", serif;
            font-weight: 700;
        }
        .title {
            font-size: 2rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            color: #000;
            font-family: "Comic Neue", serif;
            font-weight: 700;
        }
        .image {
            width: 200px;
            height: auto;
            cursor: pointer;
        }
        .image:active {
            transform: scale(1.1); /* 點擊時放大效果 */
            transition: transform 0.2s ease;
        }
        .link {
            margin-top: 1rem;
            font-size: 1.2rem;
            font-family: "Comic Neue", serif;
            font-weight: 700;
        }
        .link a {
            color: #4040ff;
            text-decoration: none;
        }
        .link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="global-number" id="globalCounterNumber">Loading...</div>
        <div class="global-title">Global Nyarin Counter</div>
        <img src="nyarin.png" alt="Nyarin" class="image" id="nyarinImage">
        <div class="title" id="counter">Nyarin Counter: 0</div>
        <audio id="nyarinSound" src="nyarin1.mp3"></audio>
        <div class="link">
            <a href="https://www.youtube.com/@narinmikure" target="_blank">Narin Mikure【VSPO! EN】</a>
        </div>
    </div>

    <script>
        let localCounter = 0; // 本地計數器
        let unsyncedClicks = 0; // 尚未同步到全局計數器的點擊數
        const globalCounterNumberElement = document.getElementById('globalCounterNumber');
        const counterElement = document.getElementById('counter');
        const nyarinImage = document.getElementById('nyarinImage');
        const nyarinSound = document.getElementById('nyarinSound');

        const googleSheetsAPI = 'https://script.google.com/macros/s/AKfycbyWHpDh-TxioEFWMdGhogH9-EWj3sN-lAq-nnBwRQCGZB76IdQXtE9rzOZ2sXKwMOsszQ/exec'; // 替換為您的 URL

        // 初始化全局計數器值
        function initializeGlobalCounter() {
            fetch(googleSheetsAPI)
                .then(response => response.json())
                .then(data => {
                    globalCounterNumberElement.textContent = data.counter;
                })
                .catch(error => {
                    console.error('Error fetching global counter:', error);
                    globalCounterNumberElement.textContent = 'Error';
                });
        }

        // 本地點擊事件
        nyarinImage.addEventListener('click', () => {
            localCounter++;
            unsyncedClicks++; // 增加未同步點擊數
            counterElement.textContent = `Nyarin Counter: ${localCounter}`;
            nyarinSound.currentTime = 0; // 重置音效到起點
            nyarinSound.play();
        });

        // 每 10 秒同步本地新增點擊數到全局計數器
        setInterval(() => {
            if (unsyncedClicks > 0) {
                fetch(`${googleSheetsAPI}?increment=${unsyncedClicks}`, {
                    method: 'POST',
                })
                .then(response => response.json())
                .then(data => {
                    globalCounterNumberElement.textContent = data.counter;
                    unsyncedClicks = 0; // 重置未同步點擊數
                })
                .catch(error => {
                    console.error('Error updating global counter:', error);
                });
            }
        }, 5000);

        // 每 10 秒獲取最新的全局計數器值
        setInterval(() => {
            fetch(googleSheetsAPI)
                .then(response => response.json())
                .then(data => {
                    globalCounterNumberElement.textContent = data.counter;
                })
                .catch(error => console.error('Error fetching global counter:', error));
        }, 5000);

        // 初始化頁面時加載全局計數器
        initializeGlobalCounter();
    </script>
</body>
</html>
